apiVersion: v1
kind: ConfigMap
metadata:
  # I've named this 'file-service' based on the configuration
  name: file-service-config
data:
  # Merged .properties and .yaml into one file
  application.yaml: |
    server:
      port: 8083
      reactive:
        session:
          timeout: 30m
        max-initial-line-length: 16384
        max-header-size: 32768
        max-chunk-size: 1048576

    spring:
      # Assuming a name for this service
      application:
        name: file-service
        
      main:
        web-application-type: reactive
        
      servlet:
        multipart:
          max-file-size: 2GB
          max-request-size: 2GB
          
      codec:
        max-in-memory-size: 16MB

      # === Redis ===
      data:
        redis:
          host: redis.default.svc.cluster.local
          port: 6379
          
      # === Security ===
      security:
        oauth2:
          resourceserver:
            jwt:
              issuer-uri: https://accounts.google.com
              
      # === Kafka ===
      kafka:
        bootstrap-servers: kafka-service.default.svc.cluster.local:9092
        producer:
          key-serializer: org.apache.kafka.common.serialization.StringSerializer
          value-serializer: org.apache.kafka.common.serialization.StringSerializer
        consumer:
          group-id: rag-pipeline-group
          auto-offset-reset: earliest
          key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          
      # === PostgreSQL ===
      datasource:
        url: jdbc:postgresql://postgres.default.svc.cluster.local:5432/postgres
        driver-class-name: org.postgresql.Driver
        # username and password will be injected from the Secret
        
      jpa:
        hibernate:
          ddl-auto: update
        show-sql: true
        properties:
          hibernate:
            format_sql: true
            dialect: org.hibernate.dialect.PostgreSQLDialect
            
      # === Elasticsearch ===
      elasticsearch:
        uris: http://elasticsearch.default.svc.cluster.local:9200
        # username and password will be injected from the Secret
        
      # === Spring AI ===
      ai:
        # api-key will be injected from the Secret
        vectorstore:
          chroma:
            client-host: 52.23.165.28
            client-port: 8000
            collection-name: drive-documents
        autoconfigure:
          exclude:
            - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioSpeechAutoConfiguration
            - org.springframework.ai.vectorstore.chroma.autoconfigure.ChromaVectorStoreAutoConfiguration

    # === App-specific ===
    app:
      jwt:
        # secret will be injected from the Secret
        expiration: 86400000 

    # === langchain4j ===
    genai:
      provider: gemini
      gemini:
        # api-key will be injected from the Secret
        model:
          text: gemini-2.0-flash-001
          code: gemini-2.0-flash-001
          image: gemini-2.0-flash-001
          embedding: text-embedding-004
          video: gemini-2.0-flash-001

    # === Logging ===
    logging:
      level:
        org:
          springframework:
            security: DEBUG
            oauth2: DEBUG
