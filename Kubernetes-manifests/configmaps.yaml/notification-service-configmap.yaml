apiVersion: v1
kind: ConfigMap
metadata:
  name: notification-service-config
  namespace: default
data:
  application.yaml: |
    server:
      port: 8086

    spring:
      application:
        name: notification-service

      main:
        allow-bean-definition-overriding: true

      # === Kafka ===
      kafka:
        bootstrap-servers: kafka-service.default.svc.cluster.local:9092
        consumer:
          group-id: rag-pipeline-group
          auto-offset-reset: earliest
          key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          properties:
            spring.json.trusted.packages: com.notification_service.*
        producer:
          key-serializer: org.apache.kafka.common.serialization.StringSerializer
          value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

      # === Redis ===
      data:
        redis:
          host: redis.default.svc.cluster.local
          port: 6379

      # === Mail ===
      mail:
        host: smtp.gmail.com
        port: 587
        protocol: smtp
        properties:
          mail.smtp.auth: true
          mail.smtp.starttls.enable: true
        # username & password injected from Secret

      # === Security ===
      security:
        oauth2:
          resourceserver:
            jwt:
              issuer-uri: https://accounts.google.com

      # === PostgreSQL ===
      datasource:
        url: jdbc:postgresql://postgres.default.svc.cluster.local:5432/postgres
        driver-class-name: org.postgresql.Driver
        # credentials from Secret

      jpa:
        hibernate:
          ddl-auto: update
        show-sql: false
        properties:
          hibernate:
            format_sql: true
            dialect: org.hibernate.dialect.PostgreSQLDialect

      # === Elasticsearch ===
      elasticsearch:
        uris: http://elasticsearch.default.svc.cluster.local:9200
        # credentials from Secret

      # === Spring AI ===
      ai:
        vectorstore:
          chroma:
            client-host: chroma.default.svc.cluster.local
            client-port: 8000
            collection-name: drive-documents
        autoconfigure:
          exclude:
            - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioSpeechAutoConfiguration
            - org.springframework.ai.vectorstore.chroma.autoconfigure.ChromaVectorStoreAutoConfiguration

    # === GenAI (langchain4j) ===
    genai:
      provider: gemini
      gemini:
        model:
          text: gemini-2.0-flash-001
          code: gemini-2.0-flash-001
          image: gemini-2.0-flash-001
          embedding: text-embedding-004
          video: gemini-2.0-flash-001

    # === App-specific ===
    app:
      jwt:
        expiration: 86400000

    # === Management & Tracing ===
    management:
      endpoints:
        web:
          exposure:
            include:
              - health
              - info
              - metrics
              - prometheus
      tracing:
        sampling:
          probability: 1.0
      otlp:
        tracing:
          endpoint: http://tempo.default.svc.cluster.local:4318/v1/traces

    # === Swagger ===
    springdoc:
      api-docs:
        path: /v3/api-docs
        enabled: true
      swagger-ui:
        path: /swagger-ui.html
        enabled: true
        operationsSorter: method
        tagsSorter: alpha
        displayRequestDuration: true
        filter: true
      show-actuator: false

    # === App Info ===
    info:
      app:
        name: Notification Service
        description: Email & notification delivery service
        version: 1.0.0
        contact:
          name: CloudSync Team
          email: support@cloudsync.com
