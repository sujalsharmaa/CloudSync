apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-config
  labels:
    app: fluent-bit
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush        1
        Log_Level    info
        Parsers_File parsers.conf

    # INPUT: Receive logs from other containers (Fluent Bit forward protocol)
    [INPUT]
        Name   forward
        Listen 0.0.0.0
        Port   24224

    # FILTER: Keep only logs matching a pattern (optional)
    [FILTER]
        Name   grep
        Match  *
        Regex  log .*

    # OUTPUT: Send logs to Elasticsearch
    [OUTPUT]
        Name            es
        Match           *
        Host            elasticsearch
        Port            9200
        Index           fluent-bit
        Logstash_Format On
        Replace_Dots    On
        Retry_Limit     False

  parsers.conf: |
    [PARSER]
        Name        json
        Format      json
        Time_Key    time
        Time_Format %d/%b/%Y:%H:%M:%S %z
